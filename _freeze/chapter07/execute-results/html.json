{
  "hash": "579a1bca756090aeb049cabe6232a000",
  "result": {
    "markdown": "---\nsubtitle: ''\n---\n\n# Biased transmission: influencer-based indirect bias {#sec-demonstrator-biased-transmission}\n\n:::{.callout-note}\nThis chapter is based on \"Chapter 5: Biased transmission: demonstrator-based indirect bias\" in @Acerbi2022.\n:::\n\nInstead of calling them demonstrators, we will call them influencers.\n\n![An influencer on a popular video platform.](img/influencer.png)\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport numpy as np \nrng = np.random.default_rng()\n\nimport pandas as pd\n```\n:::\n\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\ndef plot_multiple_runs(data_model):\n    groups = data_model.groupby(\"run\")\n    for _, g in groups:\n        g.index = g[\"generation\"]\n        g[\"p\"].plot(lw=.5, ylim=(0,1))\n\n    data_model.groupby(\"generation\")[\"p\"].mean().plot(c=\"k\", lw=\"1\")\n```\n:::\n\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\nN = 100\np_0 = 0.5\np_s = 0.05\n```\n:::\n\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\npopulation = pd.DataFrame({\n    \"trait\": rng.choice([\"A\", \"B\"], size=N, replace=True, p=[p_0, 1-p_0]),\n    \"status\": rng.choice([\"high\", \"low\"], size=N, replace=True, p=[p_s, 1-p_s])\n})\n```\n:::\n\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\npopulation.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=110}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>trait</th>\n      <th>status</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>B</td>\n      <td>low</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>A</td>\n      <td>low</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>B</td>\n      <td>low</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>B</td>\n      <td>low</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>A</td>\n      <td>low</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\np_low = 0.01\np_influencer = np.ones(N)\np_influencer[ population[\"status\"] == \"low\" ] = p_low\n```\n:::\n\n\n::: {.cell execution_count=7}\n``` {.python .cell-code}\nif sum(p_influencer) > 0:\n    ps = p_influencer / p_influencer.sum()\n    influencer_index = rng.choice(np.arange(N), size=N, p=ps, replace=True)\n    population[\"trait\"] = population.loc[influencer_index, \"trait\"].values\n```\n:::\n\n\n::: {.cell execution_count=8}\n``` {.python .cell-code}\ndef biased_transmission_influencer(N, p_0, p_s, p_low, t_max, r_max):\n    # Create the output DataFrame\n    output = pd.DataFrame({\n        \"generation\" : np.tile(np.arange(t_max), r_max),\n        \"p\" : [ np.nan ] * t_max * r_max,\n        \"run\" : np.repeat(np.arange(r_max), t_max)\n    })\n    \n    for r in range(r_max):\n            # Create first generation\n            population = pd.DataFrame({\n                \"trait\": rng.choice([\"A\", \"B\"], size=N, replace=True, p=[p_0, 1-p_0]),\n                \"status\": rng.choice([\"high\", \"low\"], size=N, replace=True, p=[p_s, 1-p_s])\n            })\n            \n            # Assign copying probabilities based on individuals' status\n            p_influencer = np.ones(N)\n            p_influencer[population[\"status\"] == \"low\"] = p_low\n            \n            # Add first generation's p for run r\n            output.loc[ r * t_max, \"p\"] = population[ population[\"trait\"] == \"A\" ].shape[0] / N\n            \n            for t in range(1, t_max):\n                # Copy individuals to previous_population DataFrame\n                previous_population = population.copy()\n                \n                # Copy traits based on status\n                if sum(p_influencer) > 0:\n                    ps = p_influencer / p_influencer.sum()\n                    influencer_index = rng.choice(np.arange(N), size=N, p=ps, replace=True)\n                    population[\"trait\"] = population.loc[influencer_index, \"trait\"].values\n                \n                # Get p and put it into output slot for this generation t and run r\n                output.loc[r * t_max + t, \"p\"] = population[ population[\"trait\"] == \"A\" ].shape[0] / N\n                \n    return output\n\n```\n:::\n\n\n::: {.cell execution_count=9}\n``` {.python .cell-code}\ndata_model = biased_transmission_influencer(N=100, p_s=0.05, p_low=0.0001, p_0=0.5, t_max=50, r_max=10)\n```\n:::\n\n\n::: {.cell execution_count=10}\n``` {.python .cell-code}\nplot_multiple_runs(data_model)\n```\n\n::: {.cell-output .cell-output-display}\n![](chapter07_files/figure-html/cell-11-output-1.png){width=571 height=434}\n:::\n:::\n\n\n::: {.cell execution_count=11}\n``` {.python .cell-code}\ndata_model = biased_transmission_influencer(N=10_000, p_s=0.005, p_low=0.0001, p_0=0.5, t_max=200, r_max=10)\nplot_multiple_runs(data_model)\n```\n\n::: {.cell-output .cell-output-display}\n![](chapter07_files/figure-html/cell-12-output-1.png){width=571 height=434}\n:::\n:::\n\n\n::: {.cell execution_count=12}\n``` {.python .cell-code}\ndef biased_transmission_influencer_2(N, p_0, p_s, p_low, t_max, r_max):\n    # Create the output DataFrame\n    output = pd.DataFrame({\n        \"generation\" : np.tile(np.arange(t_max), r_max),\n        \"p\" : [ np.nan ] * t_max * r_max,\n        \"run\" : np.repeat(np.arange(r_max), t_max)\n    })\n    \n    ... # TODO\n    \n    return output\n```\n:::\n\n\n::: {.cell execution_count=13}\n``` {.python .cell-code}\ndata_model = biased_transmission_influencer_2(N=100, p_s=0.1, p_low=0.0001, p_0=0.5, t_max=50, r_max=50)\n```\n:::\n\n\n",
    "supporting": [
      "chapter07_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}